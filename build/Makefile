#******************************************************************************#
#* build/Makefile                                                             *#
#*                                                                 2017/07/16 *#
#* Copyright (C) 2016-2017 Mochi                                              *#
#******************************************************************************#
#******************************************************************************#
#* マクロ設定                                                                 *#
#******************************************************************************#
# ディスクイメージファイル
DISK_IMG    = mochi.img

# booter
BOOTER_IPL  = objs/booter/booter-ipl.bin
BOOTER_MAIN = objs/booter/booter-main.bin

# kernel
KERNEL      = objs/kernel/kernel.bin
KERNEL_IMG  = kernel.img


#******************************************************************************#
#* phonyターゲット                                                            *#
#******************************************************************************#
# サブディレクトリも含めたコンパイル
.PHONY: all
all:
	make -C ../src/ all

# 全生成ファイルの削除
.PHONY: clean
clean:
	make -C ../src/ clean
	-rm -f $(DISK_IMG)
	-rm -f $(KERNEL_IMG)
	-rm -rf objs

# ディスクイメージの作成
.PHONY: image
image: $(DISK_IMG)


#******************************************************************************#
#* イメージファイル作成                                                       *#
#******************************************************************************#
$(DISK_IMG): all
	tools/makeimg  -o $(KERNEL_IMG) -K $(KERNEL)
	tools/makedisk -o $@ -i $(BOOTER_IPL) -b $(BOOTER_MAIN) -k $(KERNEL_IMG)
	sync

#******************************************************************************#
