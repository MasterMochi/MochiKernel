#******************************************************************************#
#* build/Makefile                                                             *#
#*                                                                 2017/07/11 *#
#* Copyright (C) 2016-2017 Mochi                                              *#
#******************************************************************************#
#******************************************************************************#
#* マクロ設定                                                                 *#
#******************************************************************************#
# ディスクイメージファイル
IMG_NAME    = mochi.img

# ループデバイス
LOOP_DEV    = /dev/loop0
LOOP_DEV_P1 = /dev/loop0p1
LOOP_DEV_P2 = /dev/loop0p2

# booter
BOOTER_IPL  = objs/booter/booter-ipl
BOOTER_MAIN = objs/booter/booter-main

# kernel
KERNEL      = objs/kernel/kernel


#******************************************************************************#
#* phonyターゲット                                                            *#
#******************************************************************************#
# サブディレクトリも含めたコンパイル
.PHONY: all
all:
	make -C ../src/ all

# 全生成ファイルの削除
.PHONY: clean
clean:
	make -C ../src/ clean
	-rm -f $(IMG_NAME)
	-rm -rf objs

# ディスクイメージの作成
.PHONY: image
image: $(IMG_NAME)


#******************************************************************************#
#* イメージファイル作成                                                       *#
#******************************************************************************#
$(IMG_NAME): all
	sync
	tools/makedisk -o $@ -i $(BOOTER_IPL) -b $(BOOTER_MAIN) -k $(KERNEL)
	sync

#******************************************************************************#
