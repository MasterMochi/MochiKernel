#******************************************************************************#
#*                                                                            *#
#* build/Makefile                                                             *#
#*                                                                 2019/04/04 *#
#* Copyright (C) 2016-2019 Mochi                                              *#
#*                                                                            *#
#******************************************************************************#
#******************************************************************************#
#* 設定                                                                       *#
#******************************************************************************#
# booter
BOOTER_IPL  = obj/booter/booter-ipl.bin
BOOTER_MAIN = obj/booter/booter-main.bin

# kernel
KERNEL      = obj/kernel/kernel

# tool
MAKEIMG     = obj/tool/makeimg
MAKEDISK    = obj/tool/makedisk

# ディスクイメージファイル
DISK_IMG    = disk.img
# OSイメージファイル
OS_IMG      = os.img


#******************************************************************************#
#* phonyターゲット                                                            *#
#******************************************************************************#
# コンパイル
.PHONY: all
all:
	make -C ../src/ all

# 全生成ファイルの削除
.PHONY: clean
clean:
	make -C ../src/ clean
	-rm -f $(DISK_IMG)
	-rm -f $(OS_IMG)
	-rm -rf obj

# ディスクイメージの作成
.PHONY: image
image: $(DISK_IMG)


#******************************************************************************#
#* イメージファイル作成                                                       *#
#******************************************************************************#
$(DISK_IMG): all
	$(MAKEIMG) -o $(OS_IMG) -K $(KERNEL)
	$(MAKEDISK) -o $@ -i $(BOOTER_IPL) -b $(BOOTER_MAIN) -k $(OS_IMG)
	sync


#******************************************************************************#
